sudo: required
language: go
services:
  - docker
env:
  global:
    - COMPOSE_VERSION=1.25.4
    - GO111MODULE=on
addons:
  apt:
    packages:
      - docker-ce
before_install:
  - curl -L https://github.com/docker/compose/releases/download/${COMPOSE_VERSION}/docker-compose-`uname -s`-`uname -m` > docker-compose
  - chmod +x docker-compose
  - sudo mv docker-compose /usr/local/bin
  - docker-compose up -d --build
script:
  - docker-compose exec golang1.11 go test
  - docker-compose exec golang1.12 go test
  - docker-compose exec golang1.13 go test
  - docker-compose exec golang1.14 go test -race -coverprofile=coverage.txt -covermode=atomic
  - diff <(docker-compose exec golang goimports -d .) <(printf "")
  - diff <(docker-compose exec golang golint ./...) <(printf "")
  - diff <(docker-compose exec golang gofmt -d .) <(printf "")

after_success:
  - curl -s https://codecov.io/bash > codecov.bash
  - echo $(docker-compose exec golang1.14 cat coverage.txt) > coverage.txt
  - bash codecov.bash -f coverage.txt
notifications:
  slack:
    secure: H/vFgRgJA69OT0nXToHf6cFwZTX0EQa0AAiuPOE8E112peYlSruqPa2aRNTMjep4umiyU3YZPrSVv7sPbuwbiHNDUqTjCkKqDGOPDJNRUIeLm6EzQLPLS5Ug754Q3hhNqQq+ErJP2L25hNZ+EIhbe2uvqxCXm/9/+8DZsL7idEX5R/r3Cu9OorRyzM+ghOAXhmSMSOkVKhttb7D3e+kwVEnQxSZU4gzT8RC9YZgjR8KJdGnoNXNnRQKwZ4IyIo+Mqh+7oK17ggm3pQoyVa4lptHK1/PJMaY0lnAnpsj5Mq9TV5E4aNldrbHlqfpb2TNu04URuGr82hi3B4GAasMiwzT1KzIWuB6hTxDhjMcZe14ieEqvvhn9KON1QZOic9N0zg5O+egv8SZpFSn7Khk2bJLo9uImuTcUPaRl+VhrdMx7IEIg9zJQ7P7P2P38vLHxZJRle5B74OF+2386LF/XpR5D9MALLlPPDB7T1zKqICCFUnVTljk6Qfl40geQcvQzx8R+NOJFUglFvLk+xJXDuTfT1fNeFXzobCKeF48oqGfJLLkxrcDmwEmM997bOaNDmZLrECg32GEydyArUtMTtfkKMHup14zf0ParXo3THJ0qrEjzxy0VPCtQjj72RkMllpTNZSU097bicII4H236ucDiZearekm8Lap5mOnKQTY=
